{% extends "layout.html" %}
{% block content %}
  <section class="card">
    <div class="card-header">
      <h2>ðŸ§ª Analyses</h2>
      <div class="button-row">
        <a class="button" href="/ui/analyses/new">New analysis</a>
      </div>
    </div>
    <p class="muted">Start a structured template or review existing analyses.</p>

    <div class="detail-grid">
      {% for template in templates %}
        <div class="card card-compact">
          <h4>{{ template.label }}</h4>
          <p class="muted">{{ template.description }}</p>
          <a class="button secondary" href="/ui/analyses/new?type={{ template.code }}">Start {{ template.label }}</a>
        </div>
      {% endfor %}
    </div>

    {% from "partials/filters_bar.html" import filter_bar %}
    {% call(section) filter_bar("/ui/analyses", "#analyses-table", "/ui/analyses/_table") %}
      {% if section == 'primary' %}
        <input type="hidden" name="page" value="1" />
        <div class="multi-select-field">
          <span class="field-label">Tags</span>
          <details class="multi-select-menu">
            <summary>
              {% if filters.tags %}
                {{ filters.tags|join(", ") }}
              {% else %}
                All tags
              {% endif %}
            </summary>
            <div class="multi-select-options">
              {% for tag in all_tags %}
                <label class="multi-select-option">
                  <input type="checkbox" name="tags" value="{{ tag.name }}" {% if tag.name in filters.tags %}checked{% endif %} />
                  <span>{{ tag.name }}</span>
                </label>
              {% endfor %}
            </div>
          </details>
        </div>
      {% else %}
        <label>
          Page size
          <select name="page_size">
            {% for size in [10, 25, 50, 100] %}
              <option value="{{ size }}" {% if filters.page_size == size %}selected{% endif %}>{{ size }}</option>
            {% endfor %}
          </select>
        </label>
        <div class="form-actions form-actions-end">
          <button class="button" type="submit">Apply filters</button>
        </div>
      {% endif %}
    {% endcall %}

    <h3 class="mt-24">Recent analyses</h3>
    {% include "partials/analyses_table.html" %}
  </section>
{% endblock %}
