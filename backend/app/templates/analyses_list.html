{% extends "layout.html" %}
{% block content %}
  <section class="card">
    <div class="card-header">
      <h2>ðŸ§ª Analyses</h2>
      <div class="button-row">
        <a class="button" href="/ui/analyses/new">New analysis</a>
      </div>
    </div>
    <p class="muted">Start a structured template or review existing analyses.</p>

    <div class="detail-grid">
      {% for template in templates %}
        <div class="card card-compact">
          <h4>{{ template.label }}</h4>
          <p class="muted">{{ template.description }}</p>
          <a class="button secondary" href="/ui/analyses/new?type={{ template.code }}">Start {{ template.label }}</a>
        </div>
      {% endfor %}
    </div>


    <form
      class="filter-grid"
      method="get"
      action="/ui/analyses"
      hx-get="/ui/analyses/_table"
      hx-target="#analyses-table"
      hx-swap="outerHTML"
      hx-push-url="true"
    >
      <input type="hidden" name="page" value="1" />
      <label>
        Tags
        <select name="tags" multiple>
          {% for tag in all_tags %}
            <option value="{{ tag.name }}" {% if tag.name in filters.tags %}selected{% endif %}>{{ tag.name }}</option>
          {% endfor %}
        </select>
      </label>
      <label>
        Page size
        <select name="page_size">
          {% for size in [10, 25, 50, 100] %}
            <option value="{{ size }}" {% if filters.page_size == size %}selected{% endif %}>{{ size }}</option>
          {% endfor %}
        </select>
      </label>
      <div class="form-actions"><button class="button secondary" type="submit">Apply filters</button></div>
    </form>

    <h3 class="mt-24">Recent analyses</h3>
    {% include "partials/analyses_table.html" %}
  </section>
{% endblock %}
