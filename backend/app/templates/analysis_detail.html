{% extends "layout.html" %}
{% block content %}
  <section class="card">
    <div class="card-header">
      <h2>üîç Analysis {{ analysis.id }}</h2>
      <div class="button-row">
        <a class="button secondary" href="/ui/analyses">Back to list</a>
      </div>
    </div>
    {% include "partials/flash_message.html" %}

    <div class="detail-grid">
      <div>
        <span class="kpi-label">Template</span>
        <strong>{{ analysis.type }}</strong>
      </div>
      <div>
        <span class="kpi-label">Status</span>
        <strong>{{ analysis.status or 'Open' }}</strong>
      </div>
      <div>
        <span class="kpi-label">Champion</span>
        <strong>{{ analysis.champion or '‚Äî' }}</strong>
      </div>
      <div>
        <span class="kpi-label">Created</span>
        <strong>{{ format_date(analysis.created_at) }}</strong>
      </div>
    </div>

    <h3>{{ analysis.title or 'Untitled analysis' }}</h3>
    <p>{{ analysis.description or 'No description yet.' }}</p>

    <div class="card" style="margin-top:16px;">
      <h4>Template sections</h4>
      {% if analysis.type == '5WHY' %}
        <p class="muted">Placeholder for 5 Why prompts (problem statement, why ladder, root cause).</p>
      {% elif analysis.type == '8D' %}
        <p class="muted">Placeholder for 8D sections (team, problem, containment, root cause, corrective actions).</p>
      {% elif analysis.type == 'A3' %}
        <p class="muted">Placeholder for A3 narrative (plan, do, check, act).</p>
      {% elif analysis.type == 'ISHIKAWA' %}
        <p class="muted">Placeholder for Ishikawa fishbone categories and notes.</p>
      {% else %}
        <p class="muted">Template details coming soon.</p>
      {% endif %}
    </div>


    <div class="card" style="margin-top:16px;">
      <h4>Tags</h4>
      {% if analysis.tags %}
        <div class="tag-list">
          {% for tag in analysis.tags %}
            <form method="post" action="/ui/analyses/{{ analysis.id }}/tags/{{ tag.id }}/delete" class="tag-form">
              <span class="tag-chip" {% if tag.color %}style="--tag-color: {{ tag.color }}"{% endif %}>{{ tag.name }}</span>
              <button class="tag-remove" type="submit">√ó</button>
            </form>
          {% endfor %}
        </div>
      {% else %}
        <p class="muted">No tags yet.</p>
      {% endif %}
      <form method="post" action="/ui/analyses/{{ analysis.id }}/tags" class="form-inline">
        <label>
          Add tag
          <input type="text" name="tag_name" list="analysis-tags-list" placeholder="Type or create tag" required />
        </label>
        <datalist id="analysis-tags-list">
          {% for tag in all_tags %}<option value="{{ tag.name }}"></option>{% endfor %}
        </datalist>
        <button class="button secondary" type="submit">Add</button>
      </form>
    </div>

    <div class="card" style="margin-top:16px;">
      <h4>Linked actions</h4>
      <p class="muted">No linked actions yet. TODO: link actions to analyses for traceability.</p>
    </div>
  </section>
{% endblock %}
