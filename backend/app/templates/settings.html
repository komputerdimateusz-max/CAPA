{% extends "layout.html" %}
{% block content %}
  <section class="card">
    <div class="card-header">
      <h2>⚙️ Global Settings</h2>
      <p class="muted">Manage shared reference data for actions, projects, and champions.</p>
    </div>
    {% include "partials/flash_message.html" %}

    <div class="detail-grid">
      <div>
        <h3>Champions</h3>
        <form class="form-grid" method="post" action="/ui/settings/champions">
          <label>
            First name
            <input
              type="text"
              name="first_name"
              required
              placeholder="e.g. Alex"
              value="{{ form.champion_first_name or '' }}"
            />
          </label>
          <label>
            Last name
            <input
              type="text"
              name="last_name"
              required
              placeholder="e.g. Martin"
              value="{{ form.champion_last_name or '' }}"
            />
          </label>
          <label>
            Email
            <input
              type="email"
              name="email"
              placeholder="alex@example.com"
              value="{{ form.champion_email or '' }}"
            />
          </label>
          <label>
            Position
            <input
              type="text"
              name="position"
              placeholder="Process Engineer"
              value="{{ form.champion_position or '' }}"
            />
          </label>
          <label>
            Birth date
            <input type="date" name="birth_date" value="{{ form.champion_birth_date or '' }}" />
          </label>
          <div class="form-actions">
            <button class="button" type="submit">Add champion</button>
          </div>
        </form>

        {% if champions %}
          <table class="table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Position</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for champion in champions %}
                <tr>
                  <td>{{ champion.full_name }}</td>
                  <td>{{ champion.email or '—' }}</td>
                  <td>{{ champion.position or '—' }}</td>
                  <td>
                    <a class="button secondary" href="/ui/settings?champion_id={{ champion.id }}">Edit</a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p class="muted">No champions yet. Add one above.</p>
        {% endif %}

        {% if selected_champion %}
          <div class="card mt-16">
            <h4>Edit champion</h4>
            <form class="form-grid" method="post" action="/ui/settings/champions/{{ selected_champion.id }}">
              <label>
                First name
                <input
                  type="text"
                  name="first_name"
                  required
                  value="{{ form.champion_first_name or selected_champion.first_name }}"
                />
              </label>
              <label>
                Last name
                <input
                  type="text"
                  name="last_name"
                  required
                  value="{{ form.champion_last_name or selected_champion.last_name }}"
                />
              </label>
              <label>
                Email
                <input
                  type="email"
                  name="email"
                  value="{{ form.champion_email or selected_champion.email or '' }}"
                />
              </label>
              <label>
                Position
                <input
                  type="text"
                  name="position"
                  value="{{ form.champion_position or selected_champion.position or '' }}"
                />
              </label>
              <label>
                Birth date
                <input
                  type="date"
                  name="birth_date"
                  value="{{ form.champion_birth_date or (selected_champion.birth_date.isoformat() if selected_champion.birth_date else '') }}"
                />
              </label>
              <div class="form-actions">
                <button class="button" type="submit">Save champion</button>
              </div>
            </form>
          </div>
        {% endif %}
      </div>

      <div>
        <h3>Projects</h3>
        <form class="form-grid" method="post" action="/ui/settings/projects">
          <label>
            Project name
            <input type="text" name="name" placeholder="e.g. Line 2 Upgrade" value="{{ form.project_name or '' }}" />
          </label>
          <label>
            Status
            <input type="text" name="status" placeholder="Open / On Hold" value="{{ form.project_status or '' }}" />
          </label>
          <label>
            Due date
            <input type="date" name="due_date" value="{{ form.project_due_date or '' }}" />
          </label>
          <div class="form-actions">
            <button class="button" type="submit">Add project</button>
          </div>
        </form>

        {% if projects %}
          <table class="table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Status</th>
                <th>Due</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {% for project in projects %}
                <tr>
                  <td>{{ project.name }}</td>
                  <td>{{ project.status or '—' }}</td>
                  <td>{{ format_date(project.due_date) }}</td>
                  <td>
                    <a class="button secondary" href="/ui/settings?project_id={{ project.id }}">Edit</a>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% else %}
          <p class="muted">No projects yet. Add one above.</p>
        {% endif %}

        {% if selected_project %}
          <div class="card mt-16">
            <h4>Edit project</h4>
            <form class="form-grid" method="post" action="/ui/settings/projects/{{ selected_project.id }}">
              <label>
                Name
                <input
                  type="text"
                  name="name"
                  value="{{ form.project_name or selected_project.name }}"
                />
              </label>
              <label>
                Status
                <input
                  type="text"
                  name="status"
                  value="{{ form.project_status or selected_project.status or '' }}"
                />
              </label>
              <label>
                Due date
                <input
                  type="date"
                  name="due_date"
                  value="{{ form.project_due_date or (selected_project.due_date.isoformat() if selected_project.due_date else '') }}"
                />
              </label>
              <div class="form-actions">
                <button class="button" type="submit">Save project</button>
              </div>
            </form>
          </div>
        {% endif %}
      </div>
    </div>
  </section>
{% endblock %}
