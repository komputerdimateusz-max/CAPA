{% extends "layout.html" %}
{% block content %}
  <div class="settings-page"><section class="card settings-section-card"><div class="settings-subpage-header"><a class="button secondary" href="/ui/settings">← Back to Settings</a><button class="button" type="button" data-open-modal="metalization-mask">Add metalization mask</button></div><h2>Metalization Masks</h2>{% include "partials/flash_message.html" %}
  {% if metalization_masks %}<div class="table-wrap"><table class="table"><thead><tr><th>Mask P/N</th><th>Description</th><th>CT (s)</th><th>HC total</th><th>Unit labour cost [PLN]</th><th></th></tr></thead><tbody>{% for mask in metalization_masks %}<tr><td>{{ mask.mask_pn }}</td><td>{{ mask.description or '—' }}</td><td>{{ mask.ct_seconds }}</td><td>{{ '%.2f'|format(mask.hc_total or 0) }}</td><td>{{ '%.2f'|format(mask.unit_labour_cost or 0) }}</td><td><a class="button secondary" href="/ui/settings/metalization-masks?mask_id={{ mask.id }}">Edit</a></td></tr>{% endfor %}</tbody></table></div>{% else %}<p class="muted">No metalization masks yet. Use Add metalization mask to create one.</p>{% endif %}
  {% if selected_metalization_mask %}<div class="card settings-inline-card"><h4>Edit metalization mask</h4><form class="form-grid" method="post" action="/ui/settings/metalization-masks/{{ selected_metalization_mask.id }}"><label>Mask P/N<input type="text" name="mask_pn" required value="{{ form.mask_pn or selected_metalization_mask.mask_pn }}" /></label><label>Description<input type="text" name="description" value="{{ form.mask_description or selected_metalization_mask.description or '' }}" /></label><label>CT (s)<input type="number" name="ct_seconds" min="0" step="0.01" required value="{{ form.mask_ct_seconds or selected_metalization_mask.ct_seconds }}" /></label><h5>HC (by function)</h5>{% for worker_type in worker_types %}<label>{{ worker_type }} HC<input type="number" name="hc_{{ worker_type.lower() }}" min="0" step="0.01" value="{{ form['hc_' ~ worker_type.lower()] if ('hc_' ~ worker_type.lower()) in form else selected_metalization_mask_hc_map.get(worker_type, 0) }}" /></label>{% endfor %}<div class="form-actions"><button class="button" type="submit">Save metalization mask</button></div></form><form method="post" action="/ui/settings/metalization-masks/{{ selected_metalization_mask.id }}/delete"><button class="button secondary" type="submit">Delete metalization mask</button></form></div>{% endif %}
  </section></div>
  <div class="modal-shell" id="metalization-mask-modal" hidden><div class="modal-backdrop settings-modal-backdrop" data-close-modal="metalization-mask"></div><aside class="create-action-panel settings-modal-panel"><div class="create-action-header"><h3>Add metalization mask</h3><button class="button secondary" type="button" data-close-modal="metalization-mask">Cancel</button></div><form class="form-grid" method="post" action="/ui/settings/metalization-masks"><label>Mask P/N<input type="text" name="mask_pn" required value="{{ form.mask_pn or '' }}" /></label><label>Description<input type="text" name="description" value="{{ form.mask_description or '' }}" /></label><label>CT (s)<input type="number" name="ct_seconds" min="0" step="0.01" required value="{{ form.mask_ct_seconds or '' }}" /></label><h5>HC (by function)</h5>{% for worker_type in worker_types %}<label>{{ worker_type }} HC<input type="number" name="hc_{{ worker_type.lower() }}" min="0" step="0.01" value="{{ form['hc_' ~ worker_type.lower()] if ('hc_' ~ worker_type.lower()) in form else 0 }}" /></label>{% endfor %}<div class="form-actions"><button class="button" type="submit">Save</button><button class="button secondary" type="button" data-close-modal="metalization-mask">Cancel</button></div></form></aside></div>
  <script>(()=>{const modal=document.getElementById("metalization-mask-modal");const openModal=()=>{modal.hidden=false;document.body.classList.add("no-scroll")};const closeModal=()=>{modal.hidden=true;document.body.classList.remove("no-scroll")};document.querySelectorAll('[data-open-modal="metalization-mask"]').forEach((button)=>button.addEventListener("click",openModal));document.querySelectorAll('[data-close-modal="metalization-mask"]').forEach((button)=>button.addEventListener("click",closeModal));if({{ (open_modal == "metalization-mask") | tojson }})openModal();})();</script>
{% endblock %}
